<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Search - MSU Historical Photos Walking Tour, Montana State University (MSU) Library</title>
  <link rel="stylesheet" href="./styles.css">
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/png" href="logo.jpg">
  <meta name="theme-color" content="#213c69" />
  <meta name="description" content="Search the MSU Historical Photos Walking Tour App - Progressive Web App Template for digital collections using MSU Historical Photos Collection at Montana State University (MSU) Library.">
  <!-- iOS -->
  <link rel="apple-touch-icon" href="./img/icons/icon-144x144.png" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-status-bar-style" content="black" />
  <meta name="mobile-web-app-title" content="MSUWalkingTour">
</head>
<body>
  <header>
    <h1>MSU Historical Photos Walking Tour</h1>
  </header>
  <nav>
    <a href="./search.html">Search</a>
    <a href="./index.html#browse">Browse</a>
    <a href="./about.html">About</a>
    <a href="./map.html">Map</a>
  </nav>
  <div class="alert" role="alert" hidden>Your browser does not support ServiceWorker. The app will not be available offline.</div>
  <main>
    <h2>Search MSU Historical Photos</h2>
    <form action="./search.html" class="search-form" id="search-form" method="GET" role="search">
      <label class="hidden" for="search-term">Search</label>
      <input class="text" type="text" id="search-term" name="q" maxlength="75" placeholder="Keywords, title..."/>
      <input class="submit" type="submit" value="Search" />                
    </form>
    <p id="search-message" aria-live="polite">Use the <a href="#search-form">search form</a> above to search for items.</p>
    <ol id="search-results"></ol>
  </main>
  <footer>
    <p>Â© Copyright Montana State University (MSU) Library</p>
    <p>Created by <a href="https://twitter.com/msulibrary">@msulibrary</a>, the source code is available on <a href="https://github.com/msulibrary">GitHub</a>.</p>
  </footer>
  <script src="./app.js"></script>
  <script>
  function getQueryVariable(variable) {
    const query = window.location.search.substring(1);
    const vars = query.split('&');

    for (let i = 0; i < vars.length; i++) {
      const pair = vars[i].split('=');

      if (pair[0] === variable) {
        return decodeURIComponent(pair[1].replace(/\+/g, '%20'));
      }
    }
  }
  // use fetch to retrieve json file and report any errors that occur
  fetch('./items.json').then(response => {
    if (response.ok) {
      response.json().then(json => {
        data = json;
        document.getElementById("search-form").onsubmit = () => {
          document.getElementById("search-message").innerHTML = "";
          document.getElementById("search-results").innerHTML = "";
          searchterm = document.getElementById("search-term").value || getQueryVariable('q');
          searchtermlower = searchterm.toLowerCase();
          j = 0;
          for (i = 0; i < data.length; i++) {
            datalower = (data[i].item.subjectTopic.toLowerCase());
            if (datalower.includes(searchtermlower)) {
              document.getElementById("search-results").innerHTML += `<li><a href="./item.html?id=${data[i].item.recordInfo_recordIdentifier}"><img alt="${data[i].item.abstract}" src="https://arc.lib.montana.edu/msu-photos/objects/thumb-${data[i].item.identifier}" /></a><p>${data[i].item.titleInfo_title}</p><p>${data[i].item.abstract}</p><p>${data[i].item.subjectTopic}</p><p>${data[i].item.originInfo_dateCreated}</p></li>`;
              j++;
            }
          }
          document.getElementById("search-message").innerHTML += `Your search for <em>${searchterm}</em> has ${j} result(s)`;
          return false;
        }
      });
    } else {
      console.log(`Request for items.json failed with response ${response.status}: ${response.statusText}`);
    }
  });
  </script>
</body>
</html>
